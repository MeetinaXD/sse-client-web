var SSEClient=function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},t.apply(this,arguments)};function r(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function u(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}c((n=n.apply(e,t||[])).next())}))}function n(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,n=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}
/**
     * SSEClient Web
     *
     * Use Server Send Event by subscribe style
     *
     * @author      MeetinaXD
     * @version     1.0.0
     * @copyright   Copyright 2023 MeetinaXD
     * @license     MIT
     */
var i={retries:3,interval:1e3};Object.freeze(i);var s=function(){function e(e,t,r){var n;this.eventSource=e,this.url=t,this.interceptor=r,this.eventSubscribers=new Map,this.emitter={all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map((function(e){e(t)})),(r=n.get("*"))&&r.slice().map((function(r){r(e,t)}))}};var i,s,o={promise:new Promise((function(e,t){i=e,s=t})),resolve:i,reject:s},u=o.promise,c=o.resolve;this.waitPromise=u,e.onopen=c,e.addEventListener("message",this._onMessageComing("message"))}return e.prototype._onMessageComing=function(e){var t=this;return function(i){return r(t,void 0,void 0,(function(){var t,r;return n(this,(function(n){switch(n.label){case 0:t=i.data;try{t=JSON.parse(t)}catch(e){}return this.interceptor?[4,this.interceptor(this.url,e,t)]:[3,2];case 1:if(!(r=n.sent()))return[2];t=r,n.label=2;case 2:return this.emitter.emit(e,t),[2]}}))}))}},e.prototype.on=function(e,t){this.emitter.on(e,t);var r=e;if("*"!==r&&"message"!==r&&!this.eventSubscribers.has(e)){var n=this._onMessageComing(r);this.eventSubscribers.set(e,n),this.eventSource.addEventListener(r,n)}return this},e.prototype.off=function(e,t){var r=e;if(this.emitter.off(e,t),"*"!==r&&"message"!==r){var n=this.eventSubscribers.get(e);this.eventSource.removeEventListener(r,n)}return this},e.prototype.offAll=function(){var e=this;this.emitter.off("*"),this.eventSubscribers.forEach((function(t,r){e.eventSource.removeEventListener(r,t)})),this.eventSubscribers.clear()},e.prototype.waitUntilOpened=function(){return this.waitPromise},e}(),o=function(){function e(e,r){var n,s;this.retryConfig=i,this.subscribers=new Map,this.eventSubscribers=new WeakMap,this.lastEventTime=new Map,this.retries=new Map,this.baseURL=null!==(n=null==e?void 0:e.baseURL)&&void 0!==n?n:"",this.interceptor=r,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:6e4,(null==e?void 0:e.retry)&&(this.retryConfig=t(t({},this.retryConfig),e.retry)),this.timeout&&setInterval(this._checkEventTime.bind(this),100)}return e.prototype._onError=function(e){var t=this;return function(i){return r(t,void 0,void 0,(function(){var t,r;return n(this,(function(n){switch(n.label){case 0:return null===(t=this.errorHandler)||void 0===t||t.call(this,e,i),this.unsubscribe(e),this.retries.has(e)||this.retries.set(e,0),this.retries.set(e,this.retries.get(e)+1),this.retryConfig.retries&&this.retries.get(e)>=this.retryConfig.retries?(console.error("[SSEClient] Too many retry, this url is no longer subscribed: ".concat(this.baseURL).concat(e),i),this.unsubscribe(e),this.retries.delete(e),null===(r=this.closeHandler)||void 0===r||r.call(this,e,i),[2]):[4,(s=this.retryConfig.interval,new Promise((function(e){setTimeout(e,s)})))];case 1:return n.sent(),this.subscribe(e),[2]}var s}))}))}},e.prototype._checkEventTime=function(){var e=this,t=Date.now();this.lastEventTime.forEach((function(r,n){var i;t-r.getTime()>e.timeout&&(null===(i=e.timeoutHandler)||void 0===i||i.call(e,n),e.unsubscribe(n))}))},e.prototype._onMessageComing=function(e){var t=this;return function(r,n,i){return t.lastEventTime.set(e,new Date),t.interceptor?t.interceptor(e,n,i):i}},e.prototype.subscribe=function(e){var t,r=this.subscribers.get(e);return r&&(t=this.eventSubscribers.get(r))||(r=new EventSource("".concat(this.baseURL).concat(e)),t=new s(r,e,this._onMessageComing(e)),this.subscribers.set(e,r),this.eventSubscribers.set(r,t),r.onerror=this._onError(e)),t},e.prototype.unsubscribe=function(e){var t,r=this.subscribers.get(e);r&&(null==r||r.close(),null===(t=this.closeHandler)||void 0===t||t.call(this,e),this.subscribers.delete(e),this.lastEventTime.delete(e),this.eventSubscribers.delete(r))},e.prototype.onTimeout=function(e){this.timeoutHandler=e},e.prototype.onError=function(e){this.errorHandler=e},e.prototype.onClose=function(e){this.closeHandler=e},e}();return e.SSEClient=o,e.SSEEventSubscriber=s,e}({});
